variable "client_secret" {
}


# We strongly recommend using the required_providers block to set the
# Azure Provider source and version being used
terraform {
  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "=3.0.0"
    }
  }
}

# Configure the Microsoft Azure Provider
provider "azurerm" {
  environment = "usgovernment"
  features {}
  client_id       = "7a30a0fb-fb31-4056-b580-f75b25bff2e2"
  client_secret   = var.client_secret
  tenant_id       = "f7c49e36-971b-42c7-b244-a88eed6c0bf6"
  subscription_id = "c0eb1fa5-dd86-490c-bd98-217a85aaa1c9"
}

#refer to a resource group
data "azurerm_resource_group" "dev" {
  name = "EIS-DEVTEST-INT-SOUTHWEST-EIS-RG"
}

#refer to a subnet
data "azurerm_subnet" "dev" {
  name                 = "N54CA-Subnet-04"
  virtual_network_name = "EIS-GOV-DEVTEST-SOUTHWEST"
  resource_group_name  = "eis-devtest-int-southwest-network-rg"
}

#create a standard lgic app with application insights and system managed identiy enabled
resource "azurerm_logic_app_standard" "dev" {
    name = "eis-devtest-example"
    location = "azurerm_resource_group.dev.location"
    resource_Group_name = azurerm_resource_Group.dev.name
    app_service_plan_id = azurerm_app_service_plan.dev.id
    storage_Account_name = azurerm_storage_Account.dev.name
    storage_Account_Access_key = azurerm_storage_account.dev.primary_access_key
 

 app_settings = {
    "FUNCTIONS_WORKER_RUNTIME" = "node"
    "WEBSITE_NODE_dEFAULT_VERSION" = "~16"
    "APPINSIGHTS_INTRUMENTATIONKEY" = AZURERM_APPLICATION_INSIGHTS.DEV.INSTRUMENTATION_Key
    "APPLICATIONINSIGHTS_CONNECTION_STRING" = azurerm_application_insights.dev.connection_string
 }

 identity {
    type = "SystemAssigned"
 }
}